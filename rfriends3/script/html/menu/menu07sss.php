<?php
 $ex_type = $ex_podcast; ht_subtitle($subno,""); $dno = substr($sno,1,2); switch($dno) { case "01": $bdir = 'user'; break; case "02": $bdir = 'apple'; break; case "03": $bdir = 'audee'; break; case "04": $bdir = 'lfr'; break; default: $bdir = 'other'; break; } switch ($subno) { case "070201": case "070202": case "070203": case "0704": case "0706": $dat0 = ht_set_val($val); $lists = rf_pcast_rss_detail($val2,1); $ttl0 = fn_edit($lists[0]['title']); $jpg0 = $lists[0]['img']; $j = strpos($jpg0,'?'); if ($j !== false) $jpg0 = substr($jpg0,0,$j); $dir = $pcastdir.$bdir.$DS.$ttl0.$DS; echo_msg(2,"$ttl0"); echo_msg(2,"$dir"); echo_msg(2,""); foreach ($dat0 as $dat) { $v = explode(",",$dat); $itemno = $v[0]; $mp3 = $v[1]; $ttl = fn_edit($lists[$itemno]['title']); if (array_key_exists('img',$lists[$itemno])){ $jpg = $lists[$itemno]['img']; $j = strpos($jpg,'?'); if ($j !== false) $jpg = substr($jpg,0,$j); if (is_null($jpg) || $jpg == "") $jpg = $jpg0; } else { $jpg = $jpg0; } $dt = $lists[$itemno]['date']; $dt0 = strtotime($dt); $dt = date("Y/m/d",$dt0); echo_msg(2,"$dt $ttl"); if ($sel == 1) { $list["name"] = $ttl; $list["date"] = $dt0; $list["mp3"] = $mp3; $list["image"] = $jpg; $mp3_list[] = $list; } else if ($sel == 2) { echo_msg(2,""); ht_webaudio2($mp3,$jpg); break 2; } else if ($sel == 3) { for ($i=0;$i<19;$i++) { $para[$i] = ""; } $para[6] = 'rss'; $para[7] = $ttl; $para[9] = $jpg; $para[11] = $mp3; $wdata = put_para($para, $ex_type); echo_msg(2,""); ht_live_server($wdata,$ex_type); break 2; } } $n = count_73($mp3_list); rf_pcast_mp3_download($n,$dir,$bdir,$ttl0,$mp3_list,80,0,0); break; case "070300": case "070301": case "070302": case "070303": $dat0 = ht_set_val($val); $flg = 0; foreach ($dat0 as $url) { $list = rf_pcast_get_audee_info($url); if ($list === false) continue; $program = fn_edit($list['program']); $dir = $pcastdir.$bdir.$DS.$program.$DS; echo_msg(2,$program); echo_msg(2,$dir); echo_msg(2,""); $flg = 1; break; } if ($flg == 0) { echo_msg(2,"音声ファイルがないか、プレミアム配信です。"); break; } if ($sel == 2) { $name = fn_edit($list['name']); $dt = $list['date']; $jpg = $list['image']; $mp3 = $list['mp3']; echo_msg(2,date("Y/m/d",$dt)." $name"); ht_webaudio2($mp3,$jpg); break; } if ($sel == 3) { $name = fn_edit($list['name']); $dt = $list['date']; $jpg = $list['image']; $mp3 = $list['mp3']; echo_msg(2,date("Y/m/d",$dt)." $name"); echo_msg(2,""); for ($i=0;$i<19;$i++) { $para[$i] = ""; } $para[6] = 'audee'; $para[7] = $name; $para[9] = $jpg; $para[11] = $mp3; $wdata = put_para($para, $ex_type); ht_live_server($wdata,$ex_type); break; } $mp3_list = array(); foreach ($dat0 as $url) { $list = rf_pcast_get_audee_info($url); if ($list === false) { echo_msg(2,"音声ファイルがないか、プレミアム配信です。"); continue; } $name = fn_edit($list['name']); $dt = $list['date']; $mp3_list[] = $list; echo_msg(2,date("Y/m/d",$dt)." $name"); } $n = count_73($mp3_list); if ($n > 0) { rf_pcast_mp3_download($n,$dir,$bdir,$program,$mp3_list,80,0,0); } break; case "0705": ht_play_abort_server("再生"); break; default: ht_development($subno,$val,2); break; } 