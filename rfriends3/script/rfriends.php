<?php
 function rf_first_menu() { global $menudef; global $mn_mode; global $rfname; global $usrdir; $nw = time(); rfmenu_title($nw); $fmt_data = rfmenu_rec($nw, 0, 1); if (is_array($fmt_data)) { echo_scr(2, ""); foreach($fmt_data as $dt) { echo_msg(2,$dt); } } $piddata = rfgw_ffplay_pid(); $n = rf_ffplay_pid_disp($piddata); echo_scr(2,""); if ($mn_mode == 0) { $rcnt = rfgw_rec_cnt_all(); } else { $rcnt = -1; } $upd = rf_get_update_check(); $fmt0 = "%2d. %s"; $fmt1 = "%2d. %s [残 %s]"; $fmt2 = "%2d. %s (%d)"; $fmt3 = "%2d. %s %s"; $n = 0; foreach($menudef as $m) { $ttl = $m['title']; $opt = $m['opt']; if ($ttl == "-") { echo_menu(2,"",1); continue; } $n++; switch($opt) { case 0: echo_menu(2,sprintf($fmt0,$n,$ttl),1); break; case 1: $ret = rf_disk($usrdir); echo_menu(2,sprintf($fmt1,$n,$ttl,$ret),1); break; case 2: echo_menu(2,sprintf($fmt2,$n,$ttl,$rcnt[0]),1); break; case 3: echo_menu(2,sprintf($fmt2,$n,$ttl,$rcnt[1]),1); break; case 4: echo_menu(2,sprintf($fmt3,$n,$ttl,$upd),1); break; default: echo_menu(2,sprintf($fmt0,$n,$ttl),1); break; } } $p_chk = premium_check(); if($p_chk > 0) { $mn_p = ",p"; } else { $mn_p = ""; } $mn_no = 1; $mn_max = count_73($menudef); echo_scr(2, ""); $ans = echo_select(2, $rfname."メニューを選択(".$mn_no."-".$mn_max.$mn_p.",r,end=x) : "); return $ans; } function rf_second_menu($ans) { global $menudef; global $menudef_s; global $menudef_t; global $mn_mode; global $scr_width; global $rfmenu; global $ui_mode; global $radiko_auth_mode; $mn_cnt = count_73($menudef_s); $fmt0 = "%2d. %s"; rfmenu_subtitle(""); $n = 0; $m2 = array(); foreach($menudef_s as $m) { $ttl = $m['title']; if ($ttl == "-") { echo_menu(2,"",1); continue; } if ($m['opt'] == 1 && $radiko_auth_mode == 3) { if (strpos($ttl,"gps") !== false ) $m['opt'] = 0; } $n++; if ($m['opt'] == 0) { $ttl2 = sprintf($fmt0,$n,$ttl); } else { $ttl2 = sprintf($fmt0,$n,"-"); } echo_menu(2,$ttl2,1); $m2[$n] = $m['opt']; } echo_menu_ret_wt(); echo_scr(2, ""); $ans2 = echo_select(2, "サブメニューを選択(1-$n) : "); if ($ans2 == "" || $ans2 == "R" || $ans2 == "r") { $ans2 = ""; } $ans2 = rfmenu_check_range($ans2,1,$n); if ($ans2 === false) { $ans2 = ""; } else { if ($m2[$ans2] == 1) $ans2 = ""; } return $ans2; } function rf_third_menu($ans,$ans2) { global $menudef; global $menudef_s; global $menudef_t; global $mn_mode; if ($mn_mode == 0) { $ret = rf_menu_ans($ans, $ans2); } else { $ret = rf_menu_ans_lite($ans, $ans2); } return $ret; } function rf_para_check($str) { global $scr_height; global $scr_width; $ret[0] = 0; $ret[1] = 0; $ret[2] = 0; $ret[3] = 0; $para = explode(",",$str); $n = count_73($para); switch($n) { case 1: $ret[0] = $para[0]; break; case 2: $ret[0] = $para[0]; $ret[1] = $para[1]; break; case 4: $ret[0] = $para[0]; $ret[1] = $para[1]; $ret[2] = $para[2]; $ret[3] = $para[3]; break; default: break; } if (($ret[0] != 0) && ($ret[0] != 1)) $ret[0] = 0; if (($ret[1] != 0) && ($ret[1] != 1)) $ret[1] = 0; if ($ret[2] == 0) $ret[2] = $scr_height; if ($ret[3] == 3) $ret[2] = $scr_width; return $ret; } require_once("rf_inc.php"); require_once("rf_menu.php"); require_once("rf_menu2.php"); require_once("rf_menu_sub.php"); require_once("rf_menu_def.php"); require_once("rf_reserve.php"); require_once("rf_radiko.php"); require_once("rf_radiko2.php"); require_once("rf_radiko3.php"); require_once("rf_radiru.php"); require_once("rf_timefree.php"); require_once("rf_ondemand.php"); require_once("rf_upd_common.php"); require_once("rf_upd_system.php"); require_once("rf_upd_tool.php"); $rfriends_mes = "ラジオ録音ツール"; $mn_mode = 0; $ui_mode = 0; if ($argc > 1) { $para = rf_para_check($argv[1]); $mn_mode = $para[0]; $ui_mode = $para[1]; if ($para[2] > 0) $scr_height = $para[2]; if ($para[3] > 0) $scr_width = $para[3]; if ($ui_mode == 1) { $ui_mode = 0; echo_msg(2, ""); echo_msg(2, "This feature has been discontinued."); echo_msg(2, ""); echo_msg(2, "rfriendsを終了します。"); echo_fin(1); exit(1); } } if (get_rfriends_exeos() != "LNX") { $ui_mode = 0; } if ($scr_height < 20) $scr_height = 20; if ($scr_height > 100) $scr_height = 100; if ($scr_width < 40) $scr_width = 40; if ($scr_width > 200) $scr_width = 200; $wt_ymax = $scr_height - 1; $wt_yadd = 7; $wt_xmax = $scr_width - 2; $wt_xadd = 4; $ip = gethostbyname($radiko_host); if ($ip == $playerurl) { $ui_mode = 0; echo_msg(2, ""); echo_msg(2, "$radiko_host"); echo_msg(2, "---- ネットワークに接続できません ---"); echo_msg(2, "---- 接続を確認してください ---"); echo_msg(2, ""); echo_msg(2, "rfriendsを終了します。"); echo_fin(1); exit(1); } else { } if (($mn_mode != 0) && (premium_check() > 0)) { $ui_mode = 0; echo_msg(2, "ラジコプレミアムにログイン中です。"); echo_msg(2, "ライトモードはラジコプレミアムでは使用できません。"); $ans = echo_yesno(2, "ログアウトしますか? (y/N): "); if ($ans == "y" || $ans == "Y") { premium_logout(); echo_msg(2, "ラジコプレミアムからログアウトしました。"); echo_msg(2, "再度実行してください。"); } echo_msg(2, ""); echo_msg(2, "rfriendsを終了します。"); $rf_stp = 1; echo_fin($rf_stp); exit($rf_stp); } $ret = rf_net_init(); $rftitile = ""; $rfsubtitle = array(); $rfmenu = array(); $ttl_no = array(); $msg_level = 2; if ($mn_mode == 0) { $menu_xml= $scrdir."menu.xml"; } else { $menu_xml= $scrdir."menu_lite.xml"; } $radiru_main_station = rf_get_radiru_main_station(0); $radiru_area_1 = rf_get_radiru_main_station(1); $rfname = rfmenu_name(); $xml = file_get_contents($menu_xml); $obj = simplexml_load_string($xml); $json = json_encode($obj); $rf_define = json_decode($json,TRUE); $menudef = $rf_define['menu']; $menudefmax = count_73($menudef); $rpt = 1; while ($rpt == 1) { $ttl_no[0] = 1; $rf_stp = 0; $ans = rf_first_menu(); if ($ans == "") { break; } if ($ans == "x" || $ans == "X") { $rf_stp = 1; if (premium_logincheck() === true) { echo_msg(2, ""); echo_msg(2, "ラジコプレミアムにログイン中です。"); echo_msg(2, "スケジュール実行のためには、ログインしたままにしてください。"); echo_scr(2, ""); } break; } if ($ans == "p" || $ans == "P") { echo_scr(2, ""); if (premium_check() > 0) { rfmenu_set_premium_area(); } break; } if ($ans == "r" || $ans == "R") { rfmenu_play_abort(0); break; } if ($ans == "a" || $ans == "A") { $ans = 10; } if (rfmenu_check_range($ans,1,$menudefmax) === false) { break; } $ttl_no[0] = 1; $ttl_no[1] = $ans; $ttl_mes[1] = $menudef[$ans-1]['title']; $menudef_s = $menudef[$ans-1]['sub']['menu']; $menudef_s_max = count_73($menudef_s); $ans2 = rf_second_menu($ans); if ($ans2 == "") { break; } if ($ans2 < 1 || $ans2 > $menudef_s_max) { break; } $ttl_no[0] = 2; $ttl_no[2] = $ans2; $ttl_mes[2] = $menudef_s[$ans2-1]['title']; $menudef_t = $menudef_s[$ans2 -1]; $ret = rf_third_menu($ans,$ans2); $rf_stp = $ret; break; } echo_fin($rf_stp); exit($rf_stp); 